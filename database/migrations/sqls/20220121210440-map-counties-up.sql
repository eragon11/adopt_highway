-- insert missing maintenance office data
-- make a map for unique combos of county/district/office 
EXEC sp_executesql @stmt=N'
IF OBJECT_ID(''COUNTY_MAINTENANCE_SECTION'', ''U'') IS NULL
BEGIN;
CREATE TABLE COUNTY_MAINTENANCE_SECTION (
	COUNTY_MAINTENANCE_SECTION_ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	COUNTY_ID INT NOT NULL FOREIGN KEY REFERENCES COUNTY(COUNTY_ID),
	MAINTENANCE_SECTION_ID INT NOT NULL FOREIGN KEY REFERENCES MAINTENANCE_SECTION(MAINTENANCE_SECTION_ID),
	CONSTRAINT AK_COUNTY_MAINTENANCE_SECTION UNIQUE(COUNTY_ID, MAINTENANCE_SECTION_ID)   
)
END;
';

DECLARE @COUNTY_MAINTENANCE_SECTION TABLE (
	CNTY_NBR INT NOT NULL,
	DIST_NBR INT NOT NULL,
	MNT_SEC_NBR INT NOT NULL
);

--
-- Following inserts generated on UAT DB using the following SQL
-- SELECT DISTINCT 
-- ags.CNTY_NBR , ags.DIST_NBR , ags.MNT_SEC_NBR
-- FROM gis.AAH_GIS_SEGMENTS ags 
-- INNER JOIN gis.AAH_GIS_COUNTIES c ON ags.CNTY_NBR  = c.TXDOT_CNTY_NBR  
-- ORDER BY 1, 2, 3
-- 

INSERT INTO @COUNTY_MAINTENANCE_SECTION (CNTY_NBR, DIST_NBR, MNT_SEC_NBR) 
VALUES (1, 10, 7),
(2, 6, 1),
(3, 11, 6),
(3, 11, 7),
(4, 16, 9),
(5, 3, 1),
(5, 3, 10),
(6, 4, 7),
(7, 15, 5),
(7, 15, 9),
(7, 15, 14),
(8, 13, 11),
(10, 15, 1),
(11, 14, 1),
(12, 3, 7),
(13, 16, 2),
(14, 9, 1),
(14, 9, 2),
(14, 9, 9),
(15, 15, 1),
(15, 15, 2),
(15, 15, 10),
(15, 15, 13),
(15, 15, 17),
(16, 14, 2),
(17, 8, 8),
(18, 9, 6),
(19, 19, 8),
(19, 19, 9),
(20, 12, 2),
(20, 12, 4),
(21, 17, 2),
(21, 17, 9),
(22, 24, 1),
(22, 24, 3),
(22, 24, 5),
(22, 24, 9),
(24, 21, 4),
(24, 22, 11),
(25, 23, 1),
(26, 17, 4),
(26, 17, 5),
(27, 14, 3),
(27, 14, 8),
(28, 14, 4),
(28, 14, 6),
(29, 13, 7),
(30, 8, 1),
(30, 8, 5),
(31, 21, 1),
(31, 21, 10),
(32, 19, 2),
(32, 19, 7),
(33, 4, 7),
(33, 4, 13),
(33, 4, 18),
(34, 19, 2),
(34, 19, 5),
(35, 5, 3),
(37, 10, 4),
(38, 25, 9),
(39, 3, 1),
(39, 3, 2),
(39, 3, 6),
(40, 5, 10),
(41, 7, 9),
(42, 23, 2),
(43, 18, 7),
(43, 18, 8),
(44, 25, 9),
(45, 13, 1),
(46, 15, 2),
(46, 15, 7),
(47, 23, 3),
(48, 7, 3),
(49, 1, 8),
(49, 3, 4),
(49, 3, 15),
(50, 9, 2),
(50, 9, 3),
(52, 6, 2),
(53, 6, 15),
(53, 7, 5),
(54, 5, 15),
(55, 24, 2),
(55, 24, 8),
(56, 4, 8),
(57, 18, 2),
(57, 18, 3),
(57, 18, 8),
(57, 18, 15),
(58, 5, 5),
(59, 4, 11),
(60, 1, 3),
(61, 18, 4),
(62, 13, 2),
(64, 22, 18),
(67, 22, 11),
(68, 23, 4),
(69, 6, 1),
(69, 6, 8),
(70, 7, 10),
(70, 7, 12),
(71, 18, 3),
(71, 18, 9),
(72, 24, 3),
(72, 24, 4),
(73, 2, 5),
(74, 9, 5),
(74, 9, 7),
(74, 9, 9),
(75, 1, 1),
(75, 1, 8),
(76, 13, 6),
(77, 8, 11),
(78, 5, 4),
(80, 12, 4),
(81, 1, 6),
(82, 17, 6),
(83, 15, 5),
(83, 15, 8),
(84, 5, 16),
(85, 12, 3),
(86, 5, 14),
(87, 14, 2),
(87, 14, 5),
(89, 16, 5),
(90, 13, 2),
(90, 13, 4),
(90, 13, 6),
(90, 14, 4),
(90, 15, 4),
(91, 4, 12),
(92, 1, 8),
(92, 18, 8),
(93, 10, 3),
(93, 10, 5),
(93, 19, 6),
(94, 17, 2),
(94, 17, 10),
(95, 14, 13),
(95, 15, 7),
(95, 15, 13),
(96, 5, 13),
(98, 9, 3),
(98, 9, 6),
(99, 4, 10),
(102, 12, 6),
(102, 12, 10),
(103, 19, 4),
(103, 19, 6),
(104, 4, 6),
(105, 8, 9),
(106, 14, 2),
(106, 14, 6),
(106, 14, 15),
(107, 4, 4),
(108, 10, 1),
(109, 21, 2),
(109, 21, 6),
(110, 9, 4),
(111, 5, 6),
(111, 5, 9),
(111, 5, 10),
(112, 2, 5),
(112, 2, 9),
(113, 1, 9),
(114, 11, 3),
(115, 8, 6),
(116, 24, 2),
(116, 24, 4),
(117, 1, 4),
(117, 1, 5),
(118, 4, 3),
(119, 7, 2),
(119, 7, 6),
(120, 2, 2),
(121, 13, 3),
(122, 20, 1),
(123, 24, 5),
(124, 20, 2),
(124, 20, 8),
(124, 20, 9),
(125, 21, 4),
(125, 22, 11),
(126, 16, 1),
(127, 2, 1),
(127, 2, 3),
(127, 18, 1),
(128, 8, 1),
(128, 8, 3),
(128, 8, 9),
(129, 16, 5),
(129, 16, 6),
(130, 18, 1),
(130, 18, 3),
(130, 18, 6),
(131, 15, 2),
(131, 15, 6),
(132, 8, 10),
(133, 14, 6),
(133, 15, 6),
(134, 7, 4),
(136, 22, 12),
(137, 16, 3),
(137, 16, 7),
(139, 1, 7),
(140, 5, 7),
(141, 23, 5),
(142, 22, 3),
(142, 22, 18),
(143, 13, 5),
(143, 13, 6),
(144, 14, 7),
(145, 17, 3),
(147, 9, 7),
(147, 17, 6),
(148, 4, 4),
(148, 4, 25),
(149, 16, 4),
(150, 14, 3),
(150, 14, 8),
(151, 6, 4),
(152, 5, 8),
(152, 5, 9),
(152, 5, 15),
(153, 5, 9),
(153, 5, 17),
(154, 17, 9),
(155, 19, 2),
(155, 19, 4),
(156, 6, 11),
(157, 14, 9),
(158, 13, 10),
(159, 22, 19),
(161, 9, 9),
(162, 15, 14),
(163, 15, 1),
(163, 15, 5),
(164, 7, 3),
(164, 7, 4),
(165, 6, 1),
(165, 6, 6),
(165, 6, 8),
(166, 17, 5),
(167, 23, 7),
(168, 8, 7),
(169, 3, 2),
(169, 3, 15),
(170, 12, 5),
(171, 4, 9),
(172, 19, 2),
(172, 19, 7),
(174, 11, 7),
(174, 11, 8),
(175, 18, 1),
(176, 20, 6),
(177, 8, 13),
(178, 16, 3),
(178, 16, 7),
(178, 16, 8),
(178, 16, 9),
(179, 4, 14),
(180, 4, 16),
(181, 20, 7),
(182, 2, 9),
(182, 23, 4),
(183, 19, 1),
(184, 2, 3),
(184, 2, 9),
(184, 2, 10),
(185, 5, 1),
(186, 6, 3),
(186, 6, 15),
(187, 11, 5),
(188, 4, 1),
(188, 4, 2),
(188, 4, 7),
(189, 24, 5),
(189, 24, 9),
(190, 1, 4),
(191, 4, 2),
(191, 4, 5),
(192, 7, 2),
(193, 7, 6),
(193, 7, 12),
(194, 1, 2),
(195, 6, 5),
(195, 6, 9),
(195, 6, 12),
(196, 16, 9),
(196, 16, 11),
(197, 4, 12),
(198, 17, 7),
(199, 18, 6),
(200, 7, 1),
(201, 10, 3),
(201, 19, 1),
(202, 11, 1),
(203, 11, 1),
(203, 11, 8),
(204, 11, 9),
(205, 16, 9),
(205, 16, 10),
(207, 7, 7),
(208, 8, 12),
(209, 8, 2),
(210, 11, 2),
(210, 11, 8),
(211, 4, 10),
(211, 4, 15),
(212, 10, 3),
(212, 10, 4),
(212, 10, 11),
(213, 2, 5),
(214, 21, 9),
(216, 7, 8),
(217, 8, 4),
(218, 7, 3),
(218, 7, 7),
(219, 5, 18),
(220, 2, 3),
(220, 2, 10),
(221, 8, 1),
(222, 6, 10),
(223, 5, 2),
(224, 3, 5),
(224, 3, 8),
(225, 19, 7),
(226, 7, 6),
(226, 7, 9),
(227, 14, 10),
(227, 14, 11),
(227, 14, 15),
(228, 11, 3),
(228, 11, 4),
(229, 20, 10),
(230, 19, 2),
(230, 19, 3),
(231, 6, 2),
(231, 6, 5),
(232, 7, 20),
(232, 15, 5),
(232, 15, 20),
(233, 22, 10),
(233, 22, 12),
(233, 22, 13),
(234, 10, 1),
(234, 10, 2),
(235, 13, 8),
(236, 17, 8),
(237, 12, 7),
(238, 6, 7),
(239, 17, 1),
(240, 22, 5),
(241, 13, 9),
(243, 3, 1),
(243, 3, 3),
(243, 3, 10),
(244, 3, 3),
(244, 3, 9),
(245, 21, 8),
(246, 14, 3),
(246, 14, 11),
(246, 14, 12),
(246, 14, 13),
(247, 15, 4),
(248, 6, 4),
(249, 2, 2),
(249, 2, 10),
(250, 10, 6),
(251, 5, 12),
(252, 3, 5),
(252, 3, 13),
(253, 21, 9),
(254, 22, 21);

INSERT INTO COUNTY_MAINTENANCE_SECTION (COUNTY_ID, MAINTENANCE_SECTION_ID)
SELECT DISTINCT c.COUNTY_ID, m.MAINTENANCE_SECTION_ID
FROM @COUNTY_MAINTENANCE_SECTION map
INNER JOIN COUNTY c ON map.CNTY_NBR = c.NUMBER
INNER JOIN DISTRICT d on map.DIST_NBR = d.NUMBER
INNER JOIN MAINTENANCE_SECTION m on 
	map.DIST_NBR = m.DISTRICT_NUMBER AND map.MNT_SEC_NBR = m.NUMBER
LEFT JOIN COUNTY_MAINTENANCE_SECTION t1 
	ON 
	t1.COUNTY_ID = c.COUNTY_ID
	AND t1.MAINTENANCE_SECTION_ID = m.MAINTENANCE_SECTION_ID
WHERE t1.COUNTY_MAINTENANCE_SECTION_ID IS NULL;

/*
COUNTY DISTRICT MAPPING
*/

-- insert missing maintenance office data
-- make a map for unique combos of county/district/office 
EXEC sp_executesql @stmt=N'
IF OBJECT_ID(''COUNTY_DISTRICT'', ''U'') IS NULL
BEGIN;
CREATE TABLE COUNTY_DISTRICT (
	COUNTY_DISTRICT_ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
	COUNTY_ID INT NOT NULL FOREIGN KEY REFERENCES COUNTY(COUNTY_ID),
	DISTRICT_ID INT NOT NULL FOREIGN KEY REFERENCES DISTRICT(DISTRICT_ID),
	CONSTRAINT AK_COUNTY_DISTRICT UNIQUE(COUNTY_ID, DISTRICT_ID)   
)
END;
';

DECLARE @COUNTY_DISTRICT TABLE (
	CNTY_NBR INT NOT NULL,
	DIST_NBR INT NOT NULL
);

--
-- Following inserts generated on UAT DB using the following SQL
-- SELECT DISTINCT 
-- ags.CNTY_NBR , ags.DIST_NBR
-- FROM gis.AAH_GIS_SEGMENTS ags 
-- INNER JOIN gis.AAH_GIS_COUNTIES c ON ags.CNTY_NBR  = c.TXDOT_CNTY_NBR  
-- ORDER BY 1, 2, 3
-- 

INSERT INTO @COUNTY_DISTRICT (CNTY_NBR, DIST_NBR) VALUES
(1, 10),
(2, 6),
(3, 11),
(4, 16),
(5, 3),
(6, 4),
(7, 15),
(8, 13),
(10, 15),
(11, 14),
(12, 3),
(13, 16),
(14, 9),
(15, 15),
(16, 14),
(17, 8),
(18, 9),
(19, 19),
(20, 12),
(21, 17),
(22, 24),
(24, 21),
(24, 22),
(25, 23),
(26, 17),
(27, 14),
(28, 14),
(29, 13),
(30, 8),
(31, 21),
(32, 19),
(33, 4),
(34, 19),
(35, 5),
(37, 10),
(38, 25),
(39, 3),
(40, 5),
(41, 7),
(42, 23),
(43, 18),
(44, 25),
(45, 13),
(46, 15),
(47, 23),
(48, 7),
(49, 1),
(49, 3),
(50, 9),
(52, 6),
(53, 6),
(53, 7),
(54, 5),
(55, 24),
(56, 4),
(57, 18),
(58, 5),
(59, 4),
(60, 1),
(61, 18),
(62, 13),
(64, 22),
(67, 22),
(68, 23),
(69, 6),
(70, 7),
(71, 18),
(72, 24),
(73, 2),
(74, 9),
(75, 1),
(76, 13),
(77, 8),
(78, 5),
(80, 12),
(81, 1),
(82, 17),
(83, 15),
(84, 5),
(85, 12),
(86, 5),
(87, 14),
(89, 16),
(90, 13),
(90, 14),
(90, 15),
(91, 4),
(92, 1),
(92, 18),
(93, 10),
(93, 19),
(94, 17),
(95, 14),
(95, 15),
(96, 5),
(98, 9),
(99, 4),
(102, 12),
(103, 19),
(104, 4),
(105, 8),
(106, 14),
(107, 4),
(108, 10),
(109, 21),
(110, 9),
(111, 5),
(112, 2),
(113, 1),
(114, 11),
(115, 8),
(116, 24),
(117, 1),
(118, 4),
(119, 7),
(120, 2),
(121, 13),
(122, 20),
(123, 24),
(124, 20),
(125, 21),
(125, 22),
(126, 16),
(127, 2),
(127, 18),
(128, 8),
(129, 16),
(130, 18),
(131, 15),
(132, 8),
(133, 14),
(133, 15),
(134, 7),
(136, 22),
(137, 16),
(139, 1),
(140, 5),
(141, 23),
(142, 22),
(143, 13),
(144, 14),
(145, 17),
(147, 9),
(147, 17),
(148, 4),
(149, 16),
(150, 14),
(151, 6),
(152, 5),
(153, 5),
(154, 17),
(155, 19),
(156, 6),
(157, 14),
(158, 13),
(159, 22),
(161, 9),
(162, 15),
(163, 15),
(164, 7),
(165, 6),
(166, 17),
(167, 23),
(168, 8),
(169, 3),
(170, 12),
(171, 4),
(172, 19),
(174, 11),
(175, 18),
(176, 20),
(177, 8),
(178, 16),
(179, 4),
(180, 4),
(181, 20),
(182, 2),
(182, 23),
(183, 19),
(184, 2),
(185, 5),
(186, 6),
(187, 11),
(188, 4),
(189, 24),
(190, 1),
(191, 4),
(192, 7),
(193, 7),
(194, 1),
(195, 6),
(196, 16),
(197, 4),
(198, 17),
(199, 18),
(200, 7),
(201, 10),
(201, 19),
(202, 11),
(203, 11),
(204, 11),
(205, 16),
(207, 7),
(208, 8),
(209, 8),
(210, 11),
(211, 4),
(212, 10),
(213, 2),
(214, 21),
(216, 7),
(217, 8),
(218, 7),
(219, 5),
(220, 2),
(221, 8),
(222, 6),
(223, 5),
(224, 3),
(225, 19),
(226, 7),
(227, 14),
(228, 11),
(229, 20),
(230, 19),
(231, 6),
(232, 7),
(232, 15),
(233, 22),
(234, 10),
(235, 13),
(236, 17),
(237, 12),
(238, 6),
(239, 17),
(240, 22),
(241, 13),
(243, 3),
(244, 3),
(245, 21),
(246, 14),
(247, 15),
(248, 6),
(249, 2),
(250, 10),
(251, 5),
(252, 3),
(253, 21),
(254, 22);


INSERT INTO COUNTY_DISTRICT (COUNTY_ID, DISTRICT_ID)
SELECT DISTINCT c.COUNTY_ID, d.DISTRICT_ID
FROM @COUNTY_DISTRICT map
INNER JOIN COUNTY c ON map.CNTY_NBR = c.NUMBER
INNER JOIN DISTRICT d on map.DIST_NBR = d.NUMBER
LEFT JOIN COUNTY_DISTRICT t1 
	ON 
	t1.COUNTY_ID = c.COUNTY_ID
	AND t1.DISTRICT_ID = d.DISTRICT_ID
WHERE t1.COUNTY_DISTRICT_ID IS NULL;

